<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <script src="bower_components/jquery/jquery.js"></script>
    <script src="bower_components/select2/select2.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
    <script src="bower_components/underscore/underscore.js"></script>

    <link href="bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet" type="text/css" media="all">
    <link href="bower_components/select2/select2.css" rel="stylesheet" type="text/css" media="all">
    <link href="bower_components/select2/select2-bootstrap.css" rel="stylesheet" type="text/css" media="all">

    <link href="css/main.css" rel="stylesheet" type="text/css" media="all">
    <style type="text/css">
      body { padding: 20px; }
    </style>

    <script src="lib/base64.js"></script>

    <script src="src/config.js"></script>
    <script src="src/templates.js"></script>
    <script src="src/jquery.drugsearch.js"></script>
    <script src="src/jquery.formsearch.js"></script>
    <script src="src/jquery.createrequest.js"></script>
    <script src="src/jquery.dashboard.js"></script>
    <script src="src/jquery.cmmhelp.js"></script>

    <script>
      $(function () {
        // Store some example PA IDs
        var ids = JSON.parse(localStorage.getItem('cmm_plugin_api_ids')) || [];
        if (ids.length === 0) {
          ids = ['DJ8BX3', 'MU4AK9', 'MH8YJ8'];
          localStorage.setItem('cmm_plugin_api_ids', JSON.stringify(ids));
        }

        $('#drug-search').drugSearch({
          apiId: config.apiId,                // Specified in src/config.js
          apiSecret: config.apiSecret,        // Specified in src/config.js
          version: 1
        });

        $('#form-search').formSearch({
          apiId: config.apiId,
          apiSecret: config.apiSecret,
          version: 1
        });

        $('#start-request').createRequest({
          apiId: config.apiId,
          apiSecret: config.apiSecret,
          version: 1,
          success: function (data, status, xhr) {
            // Temporarily store data in localstorage, to be accessed later
            var ids = JSON.parse(localStorage.getItem('cmm_plugin_api_ids'));
            ids.push(data.request.id);
            localStorage.setItem('cmm_plugin_api_ids', JSON.stringify(ids));

            alert('PA request created successfully!');
          },
          error: function (data, status, xhr) {
            alert('There was a problem creating your PA request.');
          }
        });

        $('#dashboard').dashboard({
          apiId: config.apiId,
          apiSecret: config.apiSecret,
          version: 1,
          // Search using the stored IDs from earlier, or some defaults if we haven't created any yet
          ids: JSON.parse(localStorage.getItem('cmm_plugin_api_ids'))
        });

        $('#help').showHelp();
      });
    </script>
  </head>
  <body>
    <fieldset>
      <legend>Start a new PA request</legend>
      <form action="#">
        <p>
          <label for="patient-fname">Patient First Name</label>
          <input type="text" id="patient-fname" name="request[patient][first_name]" class="form-control">
        </p>
        <p>
          <label for="patient-lname">Patient Last Name</label>
          <input type="text" id="patient-lname" name="request[patient][last_name]" class="form-control">
        </p>
        <p>
          <label for="patient-dob">Patient Date of Birth</label>
          <input type="text" id="patient-dob" name="request[patient][date_of_birth]" class="form-control">
        </p>
        <p>
          <label for="state">Patient State</label>
          <select id="state" name="request[state]" class="form-control">
            <option>Select a state</option>
            <option value="OH">Ohio</option>
          </select>
        </p>
        <p>
          <label for="drug-search">Drug</label>
          <input type="hidden" id="drug-search" name="request[drug_id]" class="form-control">
        </p>
        <p>
          <label for="form-search">Form</label>
          <input type="hidden" id="form-search" name="request[form_id]" class="form-control">
        </p>
        <p>
          <button type="submit" id="start-request" class="btn btn-primary">Start Request</button>
        </p>
      </form>
    </fieldset>

    <br><br>

    <fieldset>
      <legend>Dashboard</legend>
      <div id="dashboard"></div>
    </fieldset>

    <br><br>

    <fieldset>
      <legend>Help!</legend>
      <div id="help"></div>
    </fieldset>

  </body>
</html>
